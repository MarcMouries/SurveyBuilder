function W(z){const H=document.createElement("h3");H.className="question-title";const G=document.createElement("span");return G.className="question-number",G.textContent=`Q${this.questionNumber}. `,H.append(z),this.questionNumber++,H}function $(z,H){const G=document.createElement("div");G.className="question yes-no-question",G.dataset.index=H.toString();const K=W(z.title);G.appendChild(K);const J=document.createElement("div");J.className="yes-no";const O=C("Yes",z.name,`${z.name}-yes`),P=V(`${z.name}-yes`,"Yes");J.appendChild(O),J.appendChild(P);const U=C("No",z.name,`${z.name}-no`),Z=V(`${z.name}-no`,"No");J.appendChild(U),J.appendChild(Z),G.appendChild(J),this.surveyContainer.appendChild(G),J.addEventListener("change",(X)=>{this.setResponse(z.name,X.target.value),console.log(z.name+" - "+X.target.value),this.evaluateVisibilityConditions()})}var C=function(z,H,G){const K=document.createElement("input");return K.type="radio",K.id=G,K.name=H,K.value=z,K},V=function(z,H){const G=document.createElement("label");return G.htmlFor=z,G.textContent=H,G};function w(z,H){const G=document.createElement("div");G.className="question select-question",G.dataset.index=H.toString();const K=W(z.title);G.appendChild(K);const J=document.createElement("input");J.setAttribute("list",`${z.name}-list`),J.name=z.name,J.placeholder="Start typing";const O=document.createElement("datalist");if(O.id=`${z.name}-list`,G.appendChild(J),G.appendChild(O),this.surveyContainer.appendChild(G),z.options)z.options.forEach((P)=>{const U=document.createElement("option");U.value=P,O.appendChild(U)});else if(z.options_source)J.addEventListener("input",()=>{const P=J.value.trim();if(P.length>=2)this.fetchAndUpdateOptions(z.options_source,P,O);else O.innerHTML=""})}function M(z,H){const G=document.createElement("div");G.className="question",G.dataset.index=H.toString();const K=W(z.title);G.appendChild(K);const J=document.createElement("input");J.type="text",J.name=z.name,J.required=z.isRequired,J.className="single-line-text-input",G.appendChild(J),this.surveyContainer.appendChild(G),J.addEventListener("input",()=>{this.setResponse(z.name,J.value)})}function E(z,H){const G=document.createElement("div");G.className="question",G.dataset.index=H.toString();const K=W(z.title);G.appendChild(K);const J=document.createElement("textarea");J.name=z.name,J.required=z.isRequired,J.className="multi-line-text-input",J.placeholder="Enter your comments here...",G.appendChild(J),this.surveyContainer.appendChild(G),J.addEventListener("input",()=>{this.setResponse(z.name,J.value)})}function Y(z,H){const G=document.createElement("div");G.className="question",G.dataset.index=H.toString();const K=W(z.title);G.appendChild(K);const J=document.createElement("div");J.className=`ranking-list ${z.name}`,z.choices.forEach((O,P)=>{const U=document.createElement("div");U.setAttribute("draggable",!0),U.className="ranking-item";const Z=document.createElement("div");Z.className="drag-icon",Z.textContent="\u2261",U.appendChild(Z);const X=document.createElement("div");X.className="index",X.textContent=P+1,U.appendChild(X);const _=document.createElement("div");_.className="choice-text",_.textContent=O,U.appendChild(_),J.appendChild(U)}),G.appendChild(J),this.surveyContainer.appendChild(G)}class A{constructor(z,H){this.json=z,this.surveyContainer=document.getElementById(H),this.questionNumber=1,this.responses={},this.createSurvey()}createSurvey(){this.createSurveyTitle(this.json.surveyTitle,this.surveyContainer),this.createSurveyDescription(this.json.surveyDescription,this.surveyContainer),this.json.questions.forEach((z,H)=>{switch(z.type){case"ranking":Y.call(this,z,H);break;case"single-line-text":M.call(this,z,H);break;case"multi-line-text":E.call(this,z,H);break;case"yes-no":$.call(this,z,H);break;case"select":w.call(this,z,H);break;default:console.error("Unsupported question type: "+z.type)}}),this.addDragAndDrop(),this.createCompleteButton(this.surveyContainer)}setResponse(z,H){this.responses[z]=H}evaluateVisibilityConditions(){this.json.questions.forEach((z,H)=>{const G=this.surveyContainer.querySelector(`.question[data-index="${H}"]`);if(z.visible_when){const K=z.visible_when.split("=").map((U)=>U.trim()),J=K[0],O=K[1].toLowerCase();if((this.responses[J]?this.responses[J].toLowerCase():null)===O)G.style.display="block";else G.style.display="none"}})}createSurveyTitle(z,H){const G=document.createElement("h3");G.className="survey-title",G.textContent=z,H.appendChild(G)}createSurveyDescription(z,H){const G=document.createElement("p");G.className="survey-description",G.innerHTML=z,H.appendChild(G)}addDragAndDrop(){document.querySelectorAll(".ranking-list").forEach((H)=>{H.addEventListener("dragover",(G)=>{G.preventDefault();const K=document.querySelector(".dragging"),J=this.getDragAfterElement(H,G.clientY);if(J)H.insertBefore(K,J);else if(K)H.appendChild(K);this.updateDraggedItemIndex(K,H)}),H.addEventListener("dragstart",(G)=>{G.target.classList.add("dragging")}),H.addEventListener("dragend",(G)=>{G.target.classList.remove("dragging"),this.updateAllIndexes(H)}),H.addEventListener("drop",(G)=>{G.preventDefault(),this.updateAllIndexes(H)})})}createCompleteButton(z){const H=document.createElement("div");H.className="button-container";const G=document.createElement("button");G.className="complete-button",G.textContent="Complete",G.addEventListener("click",()=>this.finishSurvey()),H.appendChild(G),z.appendChild(H)}finishSurvey(){const z=this.getResponses();if(this.completeCallback)this.completeCallback(this.responses);this.displayThankYouPage()}getResponses(){const z={responses:[]};return this.json.questions.forEach((H)=>{const G={questionName:H.name,questionTitle:H.title,answer:null};switch(H.type){case"single-line-text":const K=this.surveyContainer.querySelector(`input[name="${H.name}"]`);G.answer=K?K.value:"";break;case"ranking":const J=Array.from(this.surveyContainer.querySelectorAll(`.${H.name} .ranking-item`));if(console.log(J),J.length)G.answer=J.map((O,P)=>({rank:P+1,text:O.querySelector(".choice-text").textContent.trim()}));break}z.responses.push(G)}),z}onComplete(z){this.completeCallback=z}displayThankYouPage(){this.surveyContainer.innerHTML="";const z=document.createElement("div");z.className="thank-you-container",z.innerHTML=`
        <h2>Thank you for your input.</h2>
        <p>You can close this page. </p>
        <p>Learn more about <a href="https://servicenow.com">Creator Workflows</a>.</>
        <div class="button-container">
            <button class="secondary-button">Prev</button>
            <button class="primary-button">Done</button>
        </div>
    `,this.surveyContainer.appendChild(z)}getDragAfterElement(z,H){return[...z.querySelectorAll(".ranking-item:not(.dragging)")].reduce((K,J)=>{const O=J.getBoundingClientRect(),P=H-O.top-O.height/2;if(P<0&&P>K.offset)return{offset:P,element:J};else return K},{offset:Number.NEGATIVE_INFINITY}).element}updateDraggedItemIndex(z,H){let G=0;Array.from(H.children).forEach((J,O)=>{if(J!==z&&J.getBoundingClientRect().top<z.getBoundingClientRect().bottom)G=O+1});const K=z.querySelector(".index");if(K)K.textContent=G+1}updateAllIndexes(z){z.querySelectorAll(".ranking-item").forEach((G,K)=>{const J=G.querySelector(".index");if(J)J.textContent=K+1})}}window.SurveyBuilder=A;
